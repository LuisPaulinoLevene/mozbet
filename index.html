<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jogo Aviator - SimulaÃ§Ã£o</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #282828;
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      text-align: center;
      padding: 20px;
      border-radius: 10px;
      background-color: #1f1f1f;
      width: 400px;
      position: relative;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 15px 32px;
      font-size: 16px;
      cursor: pointer;
      border-radius: 5px;
      margin: 10px;
    }

    button:disabled {
      background-color: #777;
      cursor: not-allowed;
    }

    .hidden {
      display: none;
    }

    #plane {
      position: absolute;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      width: 80px;
      transition: transform 0.1s linear;
    }

    #gameStatus {
      margin-top: 130px;
    }

    #progressBar {
      width: 100%;
      height: 10px;
      background-color: #ddd;
      margin: 20px 0;
      border-radius: 5px;
      position: relative;
    }

    #progress {
      height: 100%;
      background-color: #4CAF50;
      width: 100%;
      border-radius: 5px;
      position: absolute;
      transition: width 1s linear;
    }

    @keyframes flyOut {
      0% { transform: translateX(-50%) translateY(0); }
      100% { transform: translateX(300px) translateY(-400px); }
    }

    /* Barra de menu */
    #menuBar {
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 18px;
      color: #fff;
      width: 100%;
      display: flex;
      justify-content: space-between;
    }

    #menuTitle {
      font-weight: bold;
      margin-left: 10px;
    }
  </style>
</head>
<body>

<!-- âœ… BARRA DE MENU -->
<div id="menuBar">
  <span id="menuTitle">ðŸŽ® Aviator</span>
  <span id="menuSaldo">Saldo: 1000</span>
</div>

<div class="container">
  <div id="title" class="hidden">Aviator</div>
  <img id="plane" src="imagem.png" alt="AviÃ£o">

  <div id="gameStatus">
    <p id="multiplier">0x</p>
    <p id="ganho">Ganho atual: 0</p>
  </div>

  <div id="progressBar">
    <div id="progress"></div>
  </div>

  <div class="controls">
    <input type="number" id="betAmount" placeholder="Insira o valor da aposta" value="" disabled>
    <button id="betBtn" onclick="placeBet()">Apostar</button>
    <button id="withdrawBtn" onclick="withdraw()" disabled>Retirar</button>
  </div>
</div>

<!-- âœ… SONS -->
<audio id="backgroundSound" loop>
  <source src="som-fundo.mp3" type="audio/mp3">
</audio>

<audio id="aggressivePlaneSound">
  <source src="som-voo-agressivo.mp3" type="audio/mp3">
</audio>

<script>
  let multiplier = 1;
  let saldo = 1000;
  let aposta = 0;
  let ganhoAtual = 0;
  let gameStarted = false;
  let gameInterval;
  let gameTimeout;
  let progressInterval;
  let soundPlayed = false;  // VariÃ¡vel para controlar o som do voo agressivo

  const plane = document.getElementById("plane");
  const multiplierDisplay = document.getElementById("multiplier");
  const saldoDisplay = document.getElementById("menuSaldo");
  const ganhoDisplay = document.getElementById("ganho");
  const withdrawBtn = document.getElementById("withdrawBtn");
  const betBtn = document.getElementById("betBtn");
  const betAmountInput = document.getElementById("betAmount");
  const progress = document.getElementById("progress");

  const backgroundSound = document.getElementById("backgroundSound");
  const aggressivePlaneSound = document.getElementById("aggressivePlaneSound");

  // Inicia o som de fundo assim que a pÃ¡gina for carregada
  window.onload = () => {
    // Tentativa de iniciar o som de fundo, mesmo em navegadores que restringem autoplay
    backgroundSound.play().catch(() => {
      // Caso nÃ£o consiga tocar o som, tentamos novamente apÃ³s uma interaÃ§Ã£o do usuÃ¡rio
      document.addEventListener('click', () => {
        backgroundSound.play();
      });
    });
    startGame();
  };

  function startGame() {
    if (gameStarted) return;
    gameStarted = true;

    aposta = 0;
    ganhoAtual = 0;
    multiplier = 1;
    updateDisplays();

    betAmountInput.disabled = false;
    betBtn.disabled = false;
    withdrawBtn.disabled = true;

    progress.style.transition = 'none';
    progress.style.width = "100%";
    setTimeout(() => {
      progress.style.transition = 'width 1s linear';
      let currentProgress = 100;
      progressInterval = setInterval(() => {
        currentProgress -= 10;
        progress.style.width = `${currentProgress}%`;
        if (currentProgress <= 0) {
          clearInterval(progressInterval);
          beginRound();
        }
      }, 1000);
    }, 50);
  }

  function beginRound() {
    betBtn.disabled = true;
    betAmountInput.disabled = true;

    if (aposta > 0) {
      withdrawBtn.disabled = false;
    }

    // Resetando a flag de som
    soundPlayed = false;

    gameInterval = setInterval(() => {
      multiplier += Math.random() * 0.1;
      multiplierDisplay.textContent = `${multiplier.toFixed(2)}x`;

      if (aposta > 0) {
        ganhoAtual = aposta * multiplier;
        ganhoDisplay.textContent = `${ganhoAtual.toFixed(2)}`;
      }

      plane.style.transform = `translateX(-50%) translateY(-${multiplier * 4}px)`;

      // Garantir que o som sÃ³ toque quando o aviÃ£o estiver pronto para decolar (multiplicador > 10 e posiÃ§Ã£o inicial)
      if (multiplier > 10 && !soundPlayed && plane.style.transform === "translateX(-50%) translateY(0px)") {
        backgroundSound.pause();  // Pausa o som de fundo
        aggressivePlaneSound.play(); // Toca o som agressivo
        soundPlayed = true;  // Marque que o som jÃ¡ foi tocado
      }

    }, 100);

    gameTimeout = setTimeout(() => {
      clearInterval(gameInterval);
      endGame(false);
    }, 15000);
  }

  function placeBet() {
    const valor = parseFloat(betAmountInput.value);
    if (isNaN(valor) || valor <= 0) {
      alert("Insira um valor vÃ¡lido para aposta.");
      return;
    }
    if (saldo < valor) {
      alert("Saldo insuficiente.");
      return;
    }

    aposta = valor;
    saldo -= aposta;
    saldoDisplay.textContent = `Saldo: ${saldo.toFixed(2)}`;
    betBtn.disabled = true;
  }

  function withdraw() {
    if (aposta > 0 && ganhoAtual > 0) {
      saldo += ganhoAtual;
      saldoDisplay.textContent = `Saldo: ${saldo.toFixed(2)}`;
      ganhoAtual = 0;
      ganhoDisplay.textContent = "0";
      aposta = 0;
      withdrawBtn.disabled = true;
    }
  }

  function endGame(success) {
    if (!success) {
      // Parar o som de fundo imediatamente e tocar o som agressivo
      backgroundSound.pause();
      aggressivePlaneSound.play();

      plane.style.animation = "flyOut 1s forwards";
      setTimeout(() => {
        plane.style.animation = "none";
        plane.style.transform = "translateX(-50%) translateY(0)";
        resetGame();
      }, 3000);
    } else {
      resetGame();
    }
  }

  function resetGame() {
    clearInterval(gameInterval);
    clearTimeout(gameTimeout);
    gameStarted = false;
    ganhoAtual = 0;
    aposta = 0;
    multiplier = 1;
    updateDisplays();

    // Parar o som de fundo e garantir que ele seja reiniciado no prÃ³ximo jogo
    backgroundSound.pause();
    backgroundSound.currentTime = 0; // Rewind para evitar duplicaÃ§Ã£o
    setTimeout(() => {
      backgroundSound.play();
    }, 100);

    setTimeout(startGame, 100);
  }

  function updateDisplays() {
    multiplierDisplay.textContent = "0x";
    saldoDisplay.textContent = `Saldo: ${saldo.toFixed(2)}`;
    ganhoDisplay.textContent = "0";
  }
</script>

</body>
</html>
